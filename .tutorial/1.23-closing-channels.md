# Closing Lightning Channels

## The Good

## The Bad

## The Ugly


## ⚡️ Closing Our Lightning Channel

Ideally, we'd do everything in our power to ***not*** close a Lightning channel without the cooporation of our channel partner. If we perform a mutual close, we'll likely gain unilateral control over our funds quicker and pay less on chain fees.

That said, we already went through all this work creating our transactions, so let's perform an ugly manual force close.

First, let's confirm that our funding transaction is still unspent and re-inforce that all of the transactions we just created during this workshop were all off-chain.

Enter this command within your **Shell**, ensuring to replace the `<funding_tx_id>` with your **Funding Tx ID**. The `0` after just indicates that the funding input was at index 0 of this transaction, which is guarenteed for this workshop but is not always true.

```
bcli gettxout <funding_tx_id> 0
```

You should see something like the below. Notice, here is the amount of our channel, and the transaction has the 6 confirmations from when we opened the channel (unless you mined more since then!).

```
{
  "bestblock": "4538053a50040431e239cbbde64d1949e2079863872be806129b96c43c517d40",
  "confirmations": 6,
  "value": 0.04999800,
  ...
}
```

## ⚡️ Publish Our HTLC Transaction

For this exercise, we'll go through the super ugly channel closure of force closing our channel with HTLCs in it. To do this, let's start by broadcasting our **HTLC Tx Hex**. You can do this by entering the below command in your **Shell**. Make sure to replace `<htlc_tx_hex>` with your **HTLC Tx Hex**.

```
bcli sendrawtransaction <htlc_tx_hex>
```

You should see a **Tx ID** pop up, indicating that it was successfully broadcasted.

## ⚡️ Publish Our HTLC Timeout Transaction

Now do the same with your **HTLC Timeout Tx Hex**!

```
bcli sendrawtransaction <htlc_timeout_tx_hex>
```

Whoops! You should have gotten a `non-final` error. Take a moment to see if you can fix this yourself so that you can broadcast the transaction. If you need some help, click below.

<details>
  <summary>Help</summary>
  <br/>

Remember that our HTLC Timeout transaction is timelocked! This is because we gave our channel party a specific amount of time to fulfill the HTLC, so we can't close the channel and claim these funds until the timelock expires. This is one major reason why this closure type is considered very ugly.

The code behind the scenes in this Replit that created the HTLC timeout locked the transaction until block height 300. Try mining 150 blocks (`mine 150`) and see if you can broadcast the transaction now.

</details>